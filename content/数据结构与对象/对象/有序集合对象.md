### 有序集合对象

 有序集合的编码可以是`ziplist`或者`skiplist`。

`Redis`选择了同时使用字段和跳跃表两种数据结构来实现有序集合。



`ziplist`编码的有序集合对象使用压缩列表作为底层实现，每个集合元素使用两个紧挨在一起

的压缩列表节点来保存，第一个节点保存元素的成员（`member`），而第二个元素则保存元素的分支（`score`）。

压缩列表内的集合元素按分值从小到大进行排序，分值较小的元素被放置在靠近表头的位置，而分支较大的

元素则放置在靠近表尾的位置。

```c
ZADD price 8.5 apple 5.0 banana 6.0 cherry
```

`skiplist`编码的有序集合对象使用`zset`结构作为底层实现，一个`zset`同时包含一个字典和一个跳跃表。

```c
typedef struct zset {
	zskiplist *zsl;
	dict *dict;
} zset;
```

`zset`结构中的`zsl`跳跃表按分值从小到大保存了所有集合元素，每个跳跃表节点都保存了一个集合元素：

跳跃表节点的`object`属性保存了元素的成员，而跳跃表节点的`score`属性则保存了元素的分值。通过这个

跳跃表，程序可以对有序集合进行范围型操作，比如`ZRANK`、`ZRANGE`等命令就是基于跳跃表API来实现。



有序集合每个元素的成员都是一个字符串对象，而每个元素的分值都是一个`double`类型的浮点数。



> 虽然`zset`结构同时使用跳跃表和字典来保存有序集合元素，但这两种数据结构都会通过
>
> 指针来共享相同元素的成员和分值，所以同时使用跳跃表和字典来保存集合元素不会产生
>
> 任何重复成员或者分值。